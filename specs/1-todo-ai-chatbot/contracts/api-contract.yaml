# Todo AI Chatbot API Contract

## Overview
This document defines the API contract for the Todo AI Chatbot backend service. It follows RESTful principles and uses JSON for data exchange.

## Base URL
```
https://api.todo-ai-chatbot.com/v1
```

In development:
```
http://localhost:8000/api
```

## Authentication
All endpoints require authentication using Bearer tokens. Include the token in the Authorization header:

```
Authorization: Bearer {token}
```

## Common Response Structure

### Success Response
```json
{
  "success": true,
  "data": { /* response data */ },
  "message": "Optional success message"
}
```

### Error Response
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message",
    "details": { /* optional error details */ }
  }
}
```

## API Endpoints

### Authentication

#### Register User
```
POST /auth/register
```

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "securePassword123",
  "username": "johndoe"
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "data": {
    "user_id": "uuid-string",
    "email": "user@example.com",
    "username": "johndoe",
    "created_at": "2023-01-01T00:00:00Z"
  }
}
```

#### Login User
```
POST /auth/login
```

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "securePassword123"
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "access_token": "jwt-token-string",
    "token_type": "bearer"
  }
}
```

### Chat Operations

#### Send Message
```
POST /{user_id}/chat
```

**Headers:**
```
Authorization: Bearer {token}
Content-Type: application/json
```

**Request Body:**
```json
{
  "conversation_id": "optional-uuid-string",
  "message": "What tasks do I have for today?",
  "metadata": {}
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "conversation_id": "uuid-string",
    "response": "You have 2 pending tasks: 'Buy groceries' (high priority) and 'Call dentist' (medium priority)",
    "tool_calls": [
      {
        "function": "get_user_tasks",
        "arguments": {
          "status": "pending",
          "limit": 10
        }
      }
    ],
    "timestamp": "2023-01-01T00:00:00Z"
  }
}
```

### Conversation Management

#### Get User Conversations
```
GET /{user_id}/conversations
```

**Query Parameters:**
- `limit` (optional, default: 20): Number of conversations to return
- `offset` (optional, default: 0): Offset for pagination
- `sort_by` (optional, default: "updated_at"): Field to sort by
- `order` (optional, default: "desc"): Sort order ("asc" or "desc")

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "conversations": [
      {
        "conversation_id": "uuid-string",
        "title": "Task management discussion",
        "created_at": "2023-01-01T00:00:00Z",
        "updated_at": "2023-01-01T01:00:00Z",
        "status": "active",
        "message_count": 15
      }
    ],
    "total": 1,
    "limit": 20,
    "offset": 0
  }
}
```

#### Get Specific Conversation
```
GET /{user_id}/conversations/{conversation_id}
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "conversation_id": "uuid-string",
    "title": "Task management discussion",
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T01:00:00Z",
    "status": "active",
    "messages": [
      {
        "message_id": "uuid-string",
        "sender_type": "user",
        "content": "What tasks do I have for today?",
        "timestamp": "2023-01-01T00:30:00Z"
      },
      {
        "message_id": "uuid-string",
        "sender_type": "assistant",
        "content": "You have 2 pending tasks...",
        "timestamp": "2023-01-01T00:31:00Z",
        "tool_calls": [...]
      }
    ]
  }
}
```

### Task Management

#### Get User Tasks
```
GET /{user_id}/tasks
```

**Query Parameters:**
- `status` (optional): Filter by task status ("pending", "in-progress", "complete", "cancelled")
- `priority` (optional): Filter by priority ("low", "medium", "high", "urgent")
- `limit` (optional, default: 20): Number of tasks to return
- `offset` (optional, default: 0): Offset for pagination
- `sort_by` (optional, default: "created_at"): Field to sort by
- `order` (optional, default: "desc"): Sort order ("asc" or "desc")

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "tasks": [
      {
        "task_id": "uuid-string",
        "title": "Buy groceries",
        "status": "pending",
        "priority": "high",
        "deadline": "2023-01-02T00:00:00Z",
        "created_at": "2023-01-01T00:00:00Z",
        "updated_at": "2023-01-01T00:00:00Z"
      }
    ],
    "total": 1,
    "limit": 20,
    "offset": 0
  }
}
```

#### Create Task
```
POST /{user_id}/tasks
```

**Request Body:**
```json
{
  "title": "Schedule doctor appointment",
  "status": "pending",
  "priority": "medium",
  "deadline": "2023-01-15T00:00:00Z",
  "tags": ["health", "important"]
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "data": {
    "task_id": "uuid-string",
    "title": "Schedule doctor appointment",
    "status": "pending",
    "priority": "medium",
    "deadline": "2023-01-15T00:00:00Z",
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z",
    "tags": ["health", "important"]
  }
}
```

#### Update Task
```
PUT /{user_id}/tasks/{task_id}
```

**Request Body:**
```json
{
  "title": "Schedule annual doctor appointment",
  "status": "in-progress",
  "priority": "high",
  "deadline": "2023-01-20T00:00:00Z"
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "task_id": "uuid-string",
    "title": "Schedule annual doctor appointment",
    "status": "in-progress",
    "priority": "high",
    "deadline": "2023-01-20T00:00:00Z",
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T01:00:00Z"
  }
}
```

#### Delete Task
```
DELETE /{user_id}/tasks/{task_id}
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "message": "Task deleted successfully"
  }
}
```

## Error Codes

| Code | HTTP Status | Description |
|------|-------------|-------------|
| AUTH_001 | 401 | Invalid or expired token |
| AUTH_002 | 401 | User not authenticated |
| AUTH_003 | 403 | Insufficient permissions |
| VALIDATION_ERROR | 422 | Request validation failed |
| RESOURCE_NOT_FOUND | 404 | Requested resource does not exist |
| SERVER_ERROR | 500 | Internal server error |
| DATABASE_ERROR | 500 | Database operation failed |

## Rate Limiting
All authenticated endpoints are limited to 100 requests per minute per user. Exceeding this limit returns a 429 status code.

## Versioning
This API uses URI versioning. The current version is v1. Breaking changes will increment the version number.